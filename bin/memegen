#!/usr/bin/ruby

$LOAD_PATH.unshift File.expand_path("lib")
$LOAD_PATH.unshift File.expand_path("../lib")
$LOAD_PATH.unshift File.expand_path("../lib", __FILE__)

def generators
  local_generator_dir = File.expand_path("~/.memegen")
  Dir.glob(["generators/*", "#{local_generator_dir}/*"])
end

def usage
  puts 'usage: memegen <generator> <top text> <bottom text> [--list]'
  exit 1
end

# Process command
generator, top, bottom = ARGV[0..2]

# List
if generator == "--list"
  names = generators.map { |path|
    File.basename(path).gsub(/\..*/, '')
  }.sort
  
  names.each { |name| puts name }
  exit 0
end

# Require arguments
usage unless generator && (top || bottom)

# Generate
if path = generators.find { |p| p =~ /#{generator}\./ }
  require "meme_generator"
  MemeGenerator.generate(path, top, bottom)
  exit 0
else
  puts "Meme not found"
  exit 1
end
